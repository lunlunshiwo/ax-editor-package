{
    "version": 3,
    "file": "Chart.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Chart.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport PropTypes from 'prop-types';\nimport {Renderer, RendererProps} from '../factory';\nimport {ServiceStore, IServiceStore} from '../store/service';\nimport {Api, ApiObject, Action} from '../types';\nimport {filter, evalExpression} from '../utils/tpl';\nimport cx from 'classnames';\nimport LazyComponent from '../components/LazyComponent';\nimport {resizeSensor} from '../utils/resize-sensor';\nimport {resolveVariableAndFilter} from '../utils/tpl-builtin';\nimport {isApiOutdated, isEffectiveApi} from '../utils/api';\nimport {ScopedContext, IScopedContext} from '../Scoped';\n\nexport interface ChartProps extends RendererProps {\n  chartRef?: (echart: any) => void;\n  onDataFilter?: (config: any) => any;\n  api?: Api;\n  source?: string;\n  config?: object;\n  initFetch?: boolean;\n  store: IServiceStore;\n  clickAction?: Action;\n  replaceChartOption: boolean;\n}\nexport class Chart extends React.Component<ChartProps> {\n  static defaultProps: Partial<ChartProps> = {\n    offsetY: 50,\n    replaceChartOption: false\n  };\n\n  static propsList: Array<string> = [];\n\n  ref: any;\n  echarts: any;\n  unSensor: Function;\n  pending?: object;\n  timer: number;\n  mounted: boolean;\n  reloadCancel: Function;\n\n  constructor(props: ChartProps) {\n    super(props);\n\n    this.refFn = this.refFn.bind(this);\n    this.reload = this.reload.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentWillMount() {\n    const {config, api, data, initFetch, source} = this.props;\n\n    this.mounted = true;\n\n    if (source && /^\\$(?:([a-z0-9_.]+)|{.+})$/.test(source)) {\n      const ret = resolveVariableAndFilter(source, data, '| raw');\n      ret && this.renderChart(ret);\n    } else if (api && initFetch !== false) {\n      this.reload();\n    }\n\n    config && this.renderChart(config);\n  }\n\n  componentDidUpdate(prevProps: ChartProps) {\n    const props = this.props;\n    const api: string =\n      (props.api && (props.api as ApiObject).url) || (props.api as string);\n\n    if (isApiOutdated(prevProps.api, props.api, prevProps.data, props.data)) {\n      this.reload();\n    } else if (\n      props.source &&\n      /^\\$(?:([a-z0-9_.]+)|{.+})$/.test(props.source)\n    ) {\n      const prevRet = prevProps.source\n        ? resolveVariableAndFilter(prevProps.source, prevProps.data, '| raw')\n        : null;\n      const ret = resolveVariableAndFilter(props.source, props.data, '| raw');\n\n      if (prevRet !== ret) {\n        this.renderChart(ret || {});\n      }\n    } else if (props.config !== prevProps.config) {\n      this.renderChart(props.config || {});\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    clearTimeout(this.timer);\n  }\n\n  handleClick(ctx: object) {\n    const {onAction, clickAction} = this.props;\n\n    clickAction && onAction && onAction(null, clickAction, ctx);\n  }\n\n  refFn(ref: any) {\n    const chartRef = this.props.chartRef;\n    if (ref) {\n      (require as any)(\n        ['echarts', 'echarts/map/js/china', 'echarts/map/js/world'],\n        (echarts: any) => {\n          (window as any).echarts = echarts;\n          this.echarts = echarts.init(ref);\n          this.echarts.on('click', this.handleClick);\n          this.unSensor = resizeSensor(ref, () => {\n            const width = ref.offsetWidth;\n            const height = ref.offsetHeight;\n            this.echarts.resize({\n              width,\n              height\n            });\n          });\n\n          chartRef && chartRef(this.echarts);\n          this.renderChart();\n        }\n      );\n    } else {\n      chartRef && chartRef(null);\n      this.unSensor && this.unSensor();\n    }\n\n    this.ref = ref;\n  }\n\n  reload(query?: any) {\n    const {api, env, store, interval} = this.props;\n\n    if (query) {\n      return this.receive(query);\n    } else if (!env || !env.fetcher || !isEffectiveApi(api, store.data)) {\n      return;\n    }\n\n    clearTimeout(this.timer);\n    if (this.reloadCancel) {\n      this.reloadCancel();\n      delete this.reloadCancel;\n      this.echarts && this.echarts.hideLoading();\n    }\n    this.echarts && this.echarts.showLoading();\n\n    env\n      .fetcher(api, store.data, {\n        cancelExecutor: (executor: Function) => (this.reloadCancel = executor)\n      })\n      .then(result => {\n        delete this.reloadCancel;\n        this.renderChart(result.data || {});\n        this.echarts && this.echarts.hideLoading();\n\n        interval &&\n          this.mounted &&\n          (this.timer = setTimeout(this.reload, Math.max(interval, 3000)));\n      })\n      .catch(reason => {\n        if (env.isCancel(reason)) {\n          return;\n        }\n\n        env.notify('error', reason);\n        this.echarts && this.echarts.hideLoading();\n      });\n  }\n\n  receive(data: object) {\n    const store = this.props.store;\n\n    store.updateData(data);\n    this.reload();\n  }\n\n  renderChart(config?: object) {\n    config && (this.pending = config);\n    if (!this.echarts) {\n      return;\n    }\n    const onDataFilter = this.props.onDataFilter;\n\n    config = config || this.pending;\n    if (typeof config === 'string') {\n      config = new Function('return ' + config)();\n    }\n    onDataFilter && (config = onDataFilter(config) || config);\n\n    if (config) {\n      try {\n        this.echarts.setOption(config, this.props.replaceChartOption);\n      } catch (e) {\n        console.warn(e);\n      }\n    }\n  }\n\n  render() {\n    const {className, width, height, classPrefix: ns} = this.props;\n    let style = this.props.style || {};\n\n    width && (style.width = width);\n    height && (style.height = height);\n\n    return (\n      <LazyComponent\n        unMountOnHidden\n        placeholder={\n          <div className={cx(`${ns}Chart`, className)} style={style}>\n            <div className={`${ns}Chart-placeholder`}>\n              <i key=\"loading\" className=\"fa fa-spinner fa-spin fa-2x fa-fw\" />\n            </div>\n          </div>\n        }\n        component={() => (\n          <div\n            className={cx(`${ns}Chart`, className)}\n            style={style}\n            ref={this.refFn}\n          />\n        )}\n      />\n    );\n  }\n}\n\n@Renderer({\n  test: /(^|\\/)chart$/,\n  storeType: ServiceStore.name,\n  name: 'chart'\n})\nexport class ChartRenderer extends Chart {\n  static contextType = ScopedContext;\n\n  componentWillMount() {\n    super.componentWillMount();\n    const scoped = this.context as IScopedContext;\n    scoped.registerComponent(this);\n  }\n\n  componentWillUnmount() {\n    super.componentWillUnmount();\n    const scoped = this.context as IScopedContext;\n    scoped.unRegisterComponent(this);\n  }\n}\n"
    ]
}