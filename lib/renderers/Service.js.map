{
    "version": 3,
    "file": "Service.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Service.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport PropTypes from 'prop-types';\nimport {Renderer, RendererProps} from '../factory';\nimport {ServiceStore, IServiceStore} from '../store/service';\nimport {Api, SchemaNode, ApiObject, RendererData} from '../types';\nimport {filter, evalExpression} from '../utils/tpl';\nimport cx from 'classnames';\nimport Scoped, {ScopedContext, IScopedContext} from '../Scoped';\nimport {observer} from 'mobx-react';\nimport {isApiOutdated, isEffectiveApi} from '../utils/api';\nimport {Spinner} from '../components';\n\nexport interface ServiceProps extends RendererProps {\n  api?: Api;\n  schemaApi?: Api;\n  initFetch?: boolean;\n  initFetchOn?: string;\n  initFetchSchema?: boolean;\n  interval?: number;\n  silentPolling?: boolean;\n  stopAutoRefreshWhen?: string;\n  store: IServiceStore;\n  body?: SchemaNode;\n  messages: {\n    fetchSuccess?: string;\n    fetchFailed?: string;\n  };\n}\nexport default class Service extends React.Component<ServiceProps> {\n  timer: number;\n  mounted: boolean;\n\n  static defaultProps: Partial<ServiceProps> = {\n    messages: {\n      fetchFailed: '初始化失败'\n    }\n  };\n\n  static propsList: Array<string> = [];\n\n  constructor(props: ServiceProps) {\n    super(props);\n\n    this.handleQuery = this.handleQuery.bind(this);\n    this.reload = this.reload.bind(this);\n    this.silentReload = this.silentReload.bind(this);\n    this.initInterval = this.initInterval.bind(this);\n  }\n\n  componentDidMount() {\n    const {\n      schemaApi,\n      initFetchSchema,\n      api,\n      initFetch,\n      initFetchOn,\n      store,\n      messages: {fetchSuccess, fetchFailed}\n    } = this.props;\n\n    this.mounted = true;\n\n    if (isEffectiveApi(schemaApi, store.data, initFetchSchema)) {\n      store.fetchSchema(schemaApi, store.data, {\n        successMessage: fetchSuccess,\n        errorMessage: fetchFailed\n      });\n    }\n\n    if (isEffectiveApi(api, store.data, initFetch, initFetchOn)) {\n      store\n        .fetchInitData(api, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.initInterval);\n    }\n  }\n\n  componentDidUpdate(prevProps: ServiceProps) {\n    const props = this.props;\n    const store = props.store;\n\n    const {\n      messages: {fetchSuccess, fetchFailed}\n    } = props;\n\n    isApiOutdated(prevProps.api, props.api, prevProps.data, props.data) &&\n      store\n        .fetchData(props.api as Api, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.initInterval);\n\n    isApiOutdated(\n      prevProps.schemaApi,\n      props.schemaApi,\n      prevProps.data,\n      props.data\n    ) &&\n      store\n        .fetchSchema(props.schemaApi as Api, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.initInterval);\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    clearTimeout(this.timer);\n  }\n\n  initInterval(value: any) {\n    const {interval, silentPolling, stopAutoRefreshWhen, data} = this.props;\n\n    interval &&\n      this.mounted &&\n      (!stopAutoRefreshWhen || !evalExpression(stopAutoRefreshWhen, data)) &&\n      (this.timer = setTimeout(\n        silentPolling ? this.silentReload : this.reload,\n        Math.max(interval, 3000)\n      ));\n    return value;\n  }\n\n  reload(subpath?: string, query?: any, ctx?: RendererData, silent?: boolean) {\n    if (query) {\n      return this.receive(query);\n    }\n\n    const {\n      schemaApi,\n      initFetchSchema,\n      api,\n      initFetch,\n      initFetchOn,\n      store,\n      messages: {fetchSuccess, fetchFailed}\n    } = this.props;\n\n    clearTimeout(this.timer);\n\n    if (isEffectiveApi(schemaApi, store.data)) {\n      store\n        .fetchSchema(schemaApi, store.data, {\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.initInterval);\n    }\n\n    if (isEffectiveApi(api, store.data)) {\n      store\n        .fetchData(api, store.data, {\n          silent,\n          successMessage: fetchSuccess,\n          errorMessage: fetchFailed\n        })\n        .then(this.initInterval);\n    }\n  }\n\n  silentReload(target?: string, query?: any) {\n    this.reload(target, query, undefined, true);\n  }\n\n  receive(values: object) {\n    const {store} = this.props;\n\n    store.updateData(values);\n    this.reload();\n  }\n\n  handleQuery(query: any) {\n    this.receive(query);\n  }\n\n  renderBody() {\n    const {render, store, body: schema, classnames: cx} = this.props;\n\n    return (\n      <div className={cx('Service-body')}>\n        {\n          render('body', store.schema || schema, {\n            key: store.schemaKey || 'body',\n            onQuery: this.handleQuery\n          }) as JSX.Element\n        }\n      </div>\n    );\n  }\n\n  render() {\n    const {\n      className,\n      store,\n      render,\n      classPrefix: ns,\n      classnames: cx\n    } = this.props;\n\n    return (\n      <div className={cx(`${ns}Service`, className)}>\n        {store.error ? (\n          <div className={cx(`Alert Alert--danger`)}>\n            <button\n              className={cx('Alert-close')}\n              onClick={() => store.updateMessage('')}\n              type=\"button\"\n            >\n              <span>×</span>\n            </button>\n            {store.msg}\n          </div>\n        ) : null}\n\n        {this.renderBody()}\n\n        <Spinner size=\"lg\" overlay key=\"info\" show={store.loading} />\n      </div>\n    );\n  }\n}\n\n@Renderer({\n  test: /(^|\\/)service$/,\n  storeType: ServiceStore.name,\n  name: 'service'\n})\nexport class ServiceRenderer extends Service {\n  static contextType = ScopedContext;\n\n  componentWillMount() {\n    // super.componentWillMount();\n    const scoped = this.context as IScopedContext;\n    scoped.registerComponent(this);\n  }\n\n  componentWillUnmount() {\n    super.componentWillUnmount();\n    const scoped = this.context as IScopedContext;\n    scoped.unRegisterComponent(this);\n  }\n}\n"
    ]
}